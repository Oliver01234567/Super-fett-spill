<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test</title>

    <style>

        .karakter {
            height: 75px;
        }

        #spillerDiv {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #arena {
            display: flex;
        }

        .cGrid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(7, 1fr);
            background-color: black;
            height: 700px;
            width: 530px;
        }

        #motstander {
            grid-row: 1;
            grid-column: 2;

            display: flex;
            align-items: center;
            justify-content: center;
            width: 75px;
        }

        #spillerDiv {
            grid-row: 1;
            grid-column: 2;
            z-index: 1;
        }



        #Sverd {
            position: absolute;
            height: 100px;
            width: 100px;

        }

        #holdtSverd {

            height: 100px;
            width: 100px;

        }
        @keyframes død{
            100%{
                transform: rotate(90deg);
            }
        }
        @keyframes lowHP{
            25%{
                box-shadow: 0 0 30px red;
            }
            50%{
                box-shadow: none;
            }
            75%{
                box-shadow: 0 0 30px red;
            }
            100%{
                box-shadow: none;
            }
        }


        .redZone {
            background-image: url(Bilder/fire.gif);
            background-size: cover;
        }

        .orangeZone {
            background-color: orange;
        }
    </style>
</head>

<body>
    <h1><span id="healthBar">10</span></h1>
    <h1><span id="pHealthBar">35</span></h1>
    <div id="arena">
        <div class="cGrid" id="playerGrid">

            <div id="spillerDiv">
                <img src="Bilder/Rasmus.png" alt="Din fyr" class="karakter" id="karakter">
            </div>

        </div>


        <div class="cGrid">

            <div id="motstander">
                <img src="Bilder/playerIcon1.png" alt="motstander" class="karakter">
            </div>

        </div>
    </div>

    <div class="redZone"></div>

    <script>

        //skaper divene som senere blir røde
        let nummer = 1
        for (let j = 1; j < 8; j++) {
            for (let i = 1; i < 3; i++) {


                const square = document.createElement("div")

                square.id = "s-" + nummer
                nummer++
                square.style.gridColumn = i
                square.style.gridRow = j

                square.classList.add("c_" + i)
                square.classList.add("r_" + j)

                document.getElementById("playerGrid").appendChild(square)

            }
        }


        const player = document.getElementById("spillerDiv")

        var sverd = document.createElement('img');
        sverd.src = 'Bilder/sverd.gif';
        sverd.alt = "Sverd";
        sverd.id = "holdtSverd";
        document.getElementById("spillerDiv").appendChild(sverd);


        //fiendens systemer
        let stopp = setInterval(move, 1000)

        let EmyHealth = 10

        const spanHealt = document.getElementById("healthBar")

        const and = document.getElementById("motstander")

        and.addEventListener("click", skadet)


        //hvordan fienden beveger seg
        function move() {
            let y = Math.floor(Math.random() * 7) + 1
            let x = Math.floor(Math.random() * 2) + 1
            and.style.gridRow = y
            and.style.gridColumn = x
        }

        function displayDamage() {
            EmyHealth--;
            spanHealt.innerText = EmyHealth;
            spanHealt.style.color = "red"
            setTimeout(sortTekst, 500)
        }
        //hva som skjer når du skader fienden
        function skadet() {
            spillerDiv.removeChild(document.querySelector("#holdtSverd"));
            clearInterval(stopp);
            and.removeEventListener("click", skadet);



            if(EmyHealth <= 3){
                and.style.animation = ("lowHP 2s infinite linear")
            }

            var sverdSlag = document.createElement('img');
            sverdSlag.src = 'Bilder/sverdSlag.gif';
            sverdSlag.alt = "Sverd";
            sverdSlag.id = "Sverd";
            document.getElementById("motstander").appendChild(sverdSlag);

            setTimeout(fjernSverd, 1800);
            setTimeout(skapSverd, 1800);

            setTimeout(displayDamage, 1800)

            if (EmyHealth == 0) {
                clearInterval(stopp);
                setTimeout(dødfallMotstander, 1500)
                return;
            }

            setTimeout(startInterval, 2300);
        }



        function dødfallMotstander() {
            and.style.animation = "død 1s linear forwards"
        }


        function fjernSverd() {
            and.removeChild(document.querySelector("#Sverd"));
        }

        function skapSverd() {
            var sverd = document.createElement('img');
            sverd.src = 'Bilder/sverd.gif';
            sverd.alt = "Sverd";
            sverd.id = "holdtSverd";
            document.getElementById("spillerDiv").appendChild(sverd);
        }


        function startInterval() {
            move()
            stopp = setInterval(move, 1000)
            and.addEventListener("click", skadet)
        }



        //spillerens systemer
        let plyHealth = 30

        const spanPHealt = document.getElementById("pHealthBar")

        //bevegelse
        let h = 1
        let w = 2

        function BevegelseFrammover() {
            w += 1;
            spillerDiv.style.gridColumn = w;
            checkRedZone()
        }

        function BevegelseOppover() {
            h -= 1;
            spillerDiv.style.gridRow = h;
            checkRedZone()
        }

        function BevegelseNedover() {
            h += 1;
            spillerDiv.style.gridRow = h;
            checkRedZone()
        }

        function BevegelseBakover() {
            w -= 1;
            spillerDiv.style.gridColumn = w;
            checkRedZone()
        }


        document.addEventListener("keydown", function (event) {
            if (event.key === "ArrowRight" || event.key === "d" || event.key === "D") {
                BevegelseFrammover();
            } else if (event.key === "ArrowDown" || event.key === "s" || event.key === "D") {
                BevegelseNedover();
            } else if (event.key === "ArrowLeft" || event.key === "a" || event.key === "A") {
                BevegelseBakover();
            } else if (event.key === "ArrowUp" || event.key === "w" || event.key === "W") {
                BevegelseOppover();
            }


            // Setter begrensninger for hvor man kan gå.
            if (h === 8) {
                h -= 1;
                spillerDiv.style.gridRow = h;
            }

            if (w === 3) {
                w -= 1;
                spillerDiv.style.gridColumn = w;
            }

            if (w === 0) {
                w += 1;
                spillerDiv.style.gridColumn = w;
            }

            if (h === 0) {
                h += 1;
                spillerDiv.style.gridRow = h;
            }

        });

        //redZones
        attackOfTheDuck();
        setInterval(attackOfTheDuck, 9000)


        function attackOfTheDuck() {
            let a = Math.floor(Math.random() * 14) + 1

            let e = Math.floor(Math.random() * 14) + 1

            let s = Math.floor(Math.random() * 14) + 1

            let n = Math.floor(Math.random() * 14) + 1

            let d = Math.floor(Math.random() * 14) + 1

            let p = Math.floor(Math.random() * 14) + 1
            setTimeout(orangeZones, 3000)
            setTimeout(redZones, 5000)
            setTimeout(blackout, 8000)


            //funksjonene må være inne i løkken for å få tilgang til de tilfeldige tallene
            function orangeZones() {



                let orange1 = document.getElementById("s-" + a)
                orange1.classList.add("orangeZone")


                let orange2 = document.getElementById("s-" + e)
                orange2.classList.add("orangeZone")

                let orange3 = document.getElementById("s-" + s)
                orange3.classList.add("orangeZone")

                let orange4 = document.getElementById("s-" + n)
                orange4.classList.add("orangeZone")

                let orange5 = document.getElementById("s-" + d)
                orange5.classList.add("orangeZone")

                let orange6 = document.getElementById("s-" + p)
                orange6.classList.add("orangeZone")


            }

            function redZones() {
                let red1 = document.getElementById("s-" + a)
                red1.classList.add("redZone")
                red1.classList.remove("orangeZone")

                let red2 = document.getElementById("s-" + e)
                red2.classList.add("redZone")
                red2.classList.remove("orangeZone")

                let red3 = document.getElementById("s-" + s)
                red3.classList.add("redZone")
                red3.classList.remove("orangeZone")

                let red4 = document.getElementById("s-" + n)
                red4.classList.add("redZone")
                red4.classList.remove("orangeZone")

                let red5 = document.getElementById("s-" + d)
                red5.classList.add("redZone")
                red5.classList.remove("orangeZone")

                let red6 = document.getElementById("s-" + p)
                red6.classList.add("redZone")
                red6.classList.remove("orangeZone")
            }

            function blackout() {



                let black1 = document.getElementById("s-" + a)
                black1.classList.remove("redZone")


                let black2 = document.getElementById("s-" + e)
                black2.classList.remove("redZone")



                let black3 = document.getElementById("s-" + s)
                black3.classList.remove("redZone")


                let black4 = document.getElementById("s-" + n)
                black4.classList.remove("redZone")


                let black5 = document.getElementById("s-" + d)
                black5.classList.remove("redZone")


                let black6 = document.getElementById("s-" + p)
                black6.classList.remove("redZone")

            }
        }
        setInterval(checkRedZone, 1000) // redzones brenner deg, du tar 3 dmg per sekund du står der, pluss 3 hvis du går inn i en
        //redZones skader deg
        function checkRedZone() {
            const playerPositionElement = document.querySelector(".r_" + h + ".c_" + w);

            if (playerPositionElement.classList.contains("redZone")) {
                damage()
            }
        }

        function sortTekst() {
            spanPHealt.style.color = "black"
            spanHealt.style.color = "black"
        }

        function damage() {
            plyHealth = plyHealth - 3
            spanPHealt.innerText = plyHealth;
            spanPHealt.style.color = "red"
            setTimeout(sortTekst, 300)
        }
    </script>
</body>

</html>